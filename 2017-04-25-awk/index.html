<!DOCTYPE html>


  <html class="light page-post">


<head>
  <meta charset="utf-8">
  
  <title>瑞士军刀片 awk | 重剑无锋</title>

  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  
    <meta name="keywords" content="灵犀指," />
  

  <meta name="description" content="awk 起源之美女选男朋友说起瑞士军刀，可能很多人都听腻了。 有说 Emacs 是瑞士军刀的， 有说 Vim 也是瑞士军刀， 有说 Python 是瑞士军刀的。但是让我们暂时抛开对瑞士军刀的兴趣, 来拨弄一下一页小小的瑞士军刀片– awk。这个小家伙是一门小巧玲珑的特殊的编程语言。">
<meta name="keywords" content="灵犀指">
<meta property="og:type" content="article">
<meta property="og:title" content="瑞士军刀片 awk">
<meta property="og:url" content="http://chenyangguang.github.com/2017-04-25-awk/index.html">
<meta property="og:site_name" content="重剑无锋">
<meta property="og:description" content="awk 起源之美女选男朋友说起瑞士军刀，可能很多人都听腻了。 有说 Emacs 是瑞士军刀的， 有说 Vim 也是瑞士军刀， 有说 Python 是瑞士军刀的。但是让我们暂时抛开对瑞士军刀的兴趣, 来拨弄一下一页小小的瑞士军刀片– awk。这个小家伙是一门小巧玲珑的特殊的编程语言。">
<meta property="og:locale" content="default">
<meta property="og:updated_time" content="2018-08-12T07:14:27.736Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="瑞士军刀片 awk">
<meta name="twitter:description" content="awk 起源之美女选男朋友说起瑞士军刀，可能很多人都听腻了。 有说 Emacs 是瑞士军刀的， 有说 Vim 也是瑞士军刀， 有说 Python 是瑞士军刀的。但是让我们暂时抛开对瑞士军刀的兴趣, 来拨弄一下一页小小的瑞士军刀片– awk。这个小家伙是一门小巧玲珑的特殊的编程语言。">

  

  
    <link rel="icon" href="/images/pingtou.jpeg">
  

  <link href="/css/styles.css?v=c114cben" rel="stylesheet">


  

  

  

  


  
    <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.3.0/css/font-awesome.min.css">
  

</head>

<body>


  
    <span id="toolbox-mobile" class="toolbox-mobile">盒子</span>
  

  <div class="post-header CENTER">
   
  <div class="toolbox">
    <a class="toolbox-entry" href="/">
      <span class="toolbox-entry-text">盒子</span>
      <i class="icon-angle-down"></i>
      <i class="icon-home"></i>
    </a>
    <ul class="list-toolbox">
      
        <li class="item-toolbox">
          <a
            class="CIRCLE"
            href="/archives/"
            rel="noopener noreferrer"
            target="_self"
            >
            博客
          </a>
        </li>
      
        <li class="item-toolbox">
          <a
            class="CIRCLE"
            href="/tag/"
            rel="noopener noreferrer"
            target="_self"
            >
            标签
          </a>
        </li>
      
        <li class="item-toolbox">
          <a
            class="CIRCLE"
            href="/about/"
            rel="noopener noreferrer"
            target="_self"
            >
            关于
          </a>
        </li>
      
    </ul>
  </div>


</div>


  <div id="toc" class="toc-article">
    <strong class="toc-title">文章目录</strong>
    <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#awk-起源之美女选男朋友"><span class="toc-text">awk 起源之美女选男朋友</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#军刀的流程"><span class="toc-text">军刀的流程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#实用“片刀式”"><span class="toc-text">实用“片刀式”</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Awk-语言之萝卜白菜"><span class="toc-text">Awk 语言之萝卜白菜</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#刀片出鞘"><span class="toc-text">刀片出鞘</span></a></li></ol>
  </div>



<div class="content content-post CENTER">
   <article id="post-awk" class="article article-type-post" itemprop="blogPost">
  <header class="article-header">
    <h1 class="post-title">瑞士军刀片 awk</h1>

    <div class="article-meta">
      <span>
        <i class="icon-calendar"></i>
        <span>2017.04.25</span>
      </span>

      
        <span class="article-author">
          <i class="icon-user"></i>
          <span>Gitvim</span>
        </span>
      

      


      
        <span>
          <i class="icon-comment"></i>
          <a href="https://chenyangguang.github.io/2017-04-25-awk/#disqus_thread"></a>
        </span>
      

      
      <i class="fa fa-eye"></i> 
        <span id="busuanzi_container_page_pv">
           &nbsp热度 <span id="busuanzi_value_page_pv">
           <i class="fa fa-spinner fa-spin"></i></span>℃
        </span>
      
      
    </div>
  </header>

  <div class="article-content">
    
      <h3 id="awk-起源之美女选男朋友"><a href="#awk-起源之美女选男朋友" class="headerlink" title="awk 起源之美女选男朋友"></a>awk 起源之美女选男朋友</h3><p>说起瑞士军刀，可能很多人都听腻了。 有说 Emacs 是瑞士军刀的， 有说 Vim 也是瑞士军刀， 有说 Python 是瑞士军刀的。但是让我们暂时抛开对瑞士军刀的兴趣, 来拨弄一下一页小小的瑞士军刀片– awk。这个小家伙是一门小巧玲珑的特殊的编程语言。<br><a id="more"></a></p>
<p>不可我， 总结了一个最好的认识新事物的方法: 迎面冲上去。<br>看下面这组相亲数据 gfs.data : </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Li 65 177 10000</span><br><span class="line">Wang 77 180 8000</span><br><span class="line">Niu 60 199  20000</span><br><span class="line">Chen 64.5 168 5000</span><br><span class="line">Ouyang 80 200 12000</span><br><span class="line">Liu 72.5 182 9999</span><br></pre></td></tr></table></figure>
<p>这片小数据里面包含几个字段， 人名，体重，身高, 月收入的数据。 比如美女需要从这里挑选男朋友标准，怎么选出这里面身高 177 以上的高富帅呢？ </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">➜  tmp awk &apos; $3 &gt; 177 &#123; print $1,$3&#125;&apos; gfs.data </span><br><span class="line">Wang 180</span><br><span class="line">Niu 199</span><br><span class="line">Ouyang 200</span><br><span class="line">Liu 182</span><br></pre></td></tr></table></figure>
<p> tmp 是临时目录，这个是 zsh 里面的一个短路径，略过。 awk 程序的结构是 <em>pattern { action }</em> 的结构。<br>它会默认将字段看作非空白字符组成的序列。（所以你看那些中间的安安静静的空格，被当成是空气了。）剩下的，第一个字段姓名，就是 <em>$1</em>, 第二个体重是 <em>$2</em>, 177， 180, 199, 168, 200,182这些身高值就是 <em>$3</em>了, 依次类推下去。 整个一行是 $0。每个人的颜值，身家是可能不一样的, 也就是说 <em>$n</em> 的值长度是不一定一致的。</p>
<p> 单引号包起来的 <em>$3 &gt; 177</em> 是对每行扫描匹配的条件。当扫到 Wang 时， 很明显这家伙 180 超出预期值，需要多瞄几眼，看是否是 “八字” 合的来的真名天子，被挑出来了。按照这个模式一直搜到最后行， Liu 这个哥儿们也中彩了。<br>如果这位美女眼光比较高，她找男朋友的条件比较多，比如，收入要高，体重要匀称，智商要高等， 这样的话，最好是将她的条件给写到一个文件里面去， 名值曰: conditions.data。一次给她选中得意郎君。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">awk -f conditions.data gfs.data</span><br></pre></td></tr></table></figure>
<p><em>-f</em> 表示从文件中提取程序，这个标准可以给多个姑娘参考, 选, 不中？不要， 中？ 要得！ 选…..选…..海选!</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">awk -f progfile optionnal list of files</span><br></pre></td></tr></table></figure>
<p>那么选择的条件一多了， 不想一条条罗列了，怎么给婚介所一个范围？ 用到字段的数量 <em>NF</em> 了。 <em>NF</em> 是 <em>Awk</em> 计算当前行的字段数量并存储的内建的变量。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">➜  tmp awk  &apos;&#123; print NF, $1, $NF &#125;&apos; gfs.data </span><br><span class="line">4 Li 10000</span><br><span class="line">4 Wang 8000</span><br><span class="line">4 Niu 20000</span><br><span class="line">4 Chen 5000</span><br><span class="line">4 Ouyang 12000</span><br><span class="line">4 Liu 9999</span><br></pre></td></tr></table></figure>
<p>这就打出每一个 boy 的 考察的条件数量，姓名，月收入了。直接拿这条件去撒网了。</p>
<p>打印真名天子所在的相亲次序 <em>NR</em>, 也是一个内建变量，是计算到目前为止，读取到的行的数量, 这里就是相亲的次数（假设这妹子每次相亲都换人）。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">➜  tmp awk &apos;&#123;print NR, $0&#125;&apos;  gfs.data</span><br><span class="line">1 Li 65 177 10000</span><br><span class="line">2 Wang 77 180 8000</span><br><span class="line">3 Niu 60 199  20000</span><br><span class="line">4 Chen 64.5 168 5000</span><br><span class="line">5 Ouyang 80 200 12000</span><br><span class="line">6 Liu 72.5 182 9999</span><br></pre></td></tr></table></figure>
<p>这几个的条件呢？ </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">➜  tmp awk &apos;$4 &gt; 10000 &#123;print &quot;很有钱的人:&quot;, $1, &quot; 月收入:&quot;, $4 &#125;&apos; gfs.data  </span><br><span class="line">很有钱的人: Niu  月收入: 20000</span><br><span class="line">很有钱的人: Ouyang  月收入: 12000</span><br></pre></td></tr></table></figure>
<p>人太多了，薪资位数不好比较，毕竟 0 太多了嘛! 筛选一下并格式化一下， 怎么搞？ printf(format, val_1, val_2, val_3, …, val_n), </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">➜  tmp awk &apos;&#123;printf(&quot;%-8s 的月薪是 ￥%10.2f\n&quot;, $1,$4)&#125;&apos; gfs.data</span><br><span class="line">Li       的月薪是 ￥  10000.00</span><br><span class="line">Wang     的月薪是 ￥   8000.00</span><br><span class="line">Niu      的月薪是 ￥  20000.00</span><br><span class="line">Chen     的月薪是 ￥   5000.00</span><br><span class="line">Ouyang   的月薪是 ￥  12000.00</span><br><span class="line">Liu      的月薪是 ￥   9999.00</span><br></pre></td></tr></table></figure>
<p>哎呀，还是看不清谁是优质男嘛，来，排下他们的薪资高低。 薪水往地处走，人往高处挑呀！ 用管道命令 <em>sort</em> 。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">➜  tmp awk &apos;&#123;printf(&quot; %10.2f %s\n&quot;, $4, $0)&#125;&apos; gfs.data | sort -n</span><br><span class="line">    5000.00 Chen 64.5 168 5000</span><br><span class="line">    8000.00 Wang 77 180 8000</span><br><span class="line">    9999.00 Liu 72.5 182 9999</span><br><span class="line">   10000.00 Li 65 177 10000</span><br><span class="line">   12000.00 Ouyang 80 200 12000</span><br><span class="line">   20000.00 Niu 60 199  20000</span><br></pre></td></tr></table></figure>
<p>原来牛哥是这里边最有 “钱途” 的！ 既然有三个是万元薪资的了，就先锁定他们了。毕竟谁会跟钱过不去？但是不能光看工资啊，要是这人是武大郎怎么办或者√2怎么办？ 不行，还是慎重一点，高开低走，190以上的，能过眼。长大了能像郎平和朱婷一样打排球，或者弄个小姚明？ 再加点条件吧： AND, OR 和 NOT, 用 &amp;&amp;, || 和 !</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">➜  tmp awk &apos;$4 &gt;=10000 &amp;&amp; $3 &gt; 190 &#123; print $0&#125;&apos; gfs.data</span><br><span class="line">Niu 60 199  20000</span><br><span class="line">Ouyang 80 200 12000</span><br></pre></td></tr></table></figure>
<p>这个输出少了一个醒目的标题, 说不定有妹子错将体重看成是腰围呢？为避免不必要的误解发生，还是加个头吧。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">➜  tmp awk &apos;BEGIN &#123;print &quot;姓名 体重 身高 薪水&quot;; print &quot;&quot;&#125;&#123;print($0)&#125;&apos; gfs.data        </span><br><span class="line">姓名 体重 身高 薪水</span><br><span class="line"></span><br><span class="line">Li 65 177 10000</span><br><span class="line">Wang 77 180 8000</span><br><span class="line">Niu 60 199  20000</span><br><span class="line">Chen 64.5 168 5000</span><br><span class="line">Ouyang 80 200 12000</span><br><span class="line">Liu 72.5 182 9999</span><br></pre></td></tr></table></figure></p>
<p>哎呀，提前到约会地点了，闲着没事干，要么比较一下这些人的平均工资？</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">➜  tmp awk &apos;&#123;salary = salary + $4&#125; END &#123;print NR, &quot;个人&quot;;  print &quot;总共月薪：&quot;, salary; print &quot;平均月 薪:&quot;, salary/NR&#125;&apos; gfs.data        </span><br><span class="line">6 个人</span><br><span class="line">总共月薪： 64999</span><br><span class="line">平均月薪: 10833.2</span><br></pre></td></tr></table></figure>
<p>还不错嘛！人还没来，将所有相亲的人名品起来能组成一首诗么？ </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">➜  tmp awk &apos;&#123;names = names $1 &quot; &quot;&#125; END &#123;print names &#125;&apos;  gfs.data</span><br><span class="line">Li Wang Niu Chen Ouyang Liu</span><br></pre></td></tr></table></figure>
<p>好吧，并没有。这些人名有多少笔画?啊不，是有几个字母组成？ </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">➜  tmp awk &apos; &#123;print $1, length($1) &#125; &apos; gfs.data</span><br><span class="line">Li 2</span><br><span class="line">Wang 4</span><br><span class="line">Niu 3</span><br><span class="line">Chen 4</span><br><span class="line">Ouyang 6</span><br><span class="line">Liu 3</span><br></pre></td></tr></table></figure>
<h3 id="军刀的流程"><a href="#军刀的流程" class="headerlink" title="军刀的流程"></a>军刀的流程</h3><p>if-else 筛筛 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">➜  tmp awk &apos;$4 &gt; 10000 &#123;n =  n + 1; salary = salary + $4 &#125;&#123; if (n &gt; 0 &amp;&amp; $4 &gt; 10000)  print $1, &quot;你有戏哟&quot;; else &#123;print $1, &quot;你被out了&quot;&#125; &#125;&apos; gfs.data</span><br><span class="line">Li 你被out了</span><br><span class="line">Wang 你被out了</span><br><span class="line">Niu 你有戏哟</span><br><span class="line">Chen 你被out了</span><br><span class="line">Ouyang 你有戏哟</span><br><span class="line">Liu 你被out了</span><br></pre></td></tr></table></figure>
<p>while 循环, 从头梳理一边<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">awk &apos;&#123; line[NR] = $0 &#125; END &#123; i = NR ;while (i&gt;0) &#123; print line[i]; i = i - 1 &#125;&#125; &apos; gfs.data</span><br><span class="line">Liu 72.5 182 9999</span><br><span class="line">Ouyang 80 200 12000</span><br><span class="line">Chen 64.5 168 5000</span><br><span class="line">Niu 60 199  20000</span><br><span class="line">Wang 77 180 8000</span><br><span class="line">Li 65 177 10000</span><br></pre></td></tr></table></figure></p>
<p>for  九九归一<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">➜  tmp awk &apos;BEGIN &#123;for (i=1; i &lt;=9; ++i) print i&#125;&apos;                            </span><br><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td></tr></table></figure></p>
<h3 id="实用“片刀式”"><a href="#实用“片刀式”" class="headerlink" title="实用“片刀式”"></a>实用“片刀式”</h3><p>输入行的总行数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">➜  tmp awk &apos;END &#123; print NR&#125;&apos; gfs.data</span><br><span class="line">6</span><br></pre></td></tr></table></figure>
<p>打印第四行 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">➜  tmp awk &apos; NR == 4 &apos; gfs.data</span><br><span class="line">Chen 64.5 168 5000</span><br></pre></td></tr></table></figure>
<p>输出每一行最后一个字段 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">➜  tmp awk &apos; &#123;print $NF&#125;&apos; gfs.data</span><br><span class="line">10000</span><br><span class="line">8000</span><br><span class="line">20000</span><br><span class="line">5000</span><br><span class="line">12000</span><br><span class="line">9999</span><br></pre></td></tr></table></figure>
<p>打印最后一行的最后一个字段</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">➜  tmp awk &apos;&#123;field = $NF&#125; END &#123; print field &#125;&apos;  gfs.data</span><br><span class="line">9999</span><br></pre></td></tr></table></figure>
<p>打印字段数多于 3 个的输入行</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">➜  tmp awk &apos;NF&gt;3&apos; gfs.data</span><br><span class="line">Li 65 177 10000</span><br><span class="line">Wang 77 180 8000</span><br><span class="line">Niu 60 199  20000</span><br><span class="line">Chen 64.5 168 5000</span><br><span class="line">Ouyang 80 200 12000</span><br><span class="line">Liu 72.5 182 9999</span><br></pre></td></tr></table></figure>
<p>打印最后一个字段值大于10000的输入行</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">➜  tmp awk &apos;$NF &gt; 10000 &apos; gfs.data </span><br><span class="line">Niu 60 199  20000</span><br><span class="line">Ouyang 80 200 12000</span><br></pre></td></tr></table></figure>
<p>打印所有输入行的字段数的总和</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">➜  tmp awk &apos; &#123;nf = nf + NF&#125; END &#123;print nf&#125; &apos; gfs.data</span><br><span class="line">24</span><br></pre></td></tr></table></figure>
<p>打印包含 /Niu/ 的行的数量</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">➜  tmp awk &apos; /Niu/ &#123;nlines = nlines + 1&#125; END &#123;print nlines&#125;&apos; gfs.data</span><br><span class="line">1</span><br></pre></td></tr></table></figure>
<p>打印具有最大值的第4个字段，以及包含它的行(假设 $1 总是正的)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">➜  tmp awk &apos;$4 &gt; max &#123; max=$4; maxline=$0 &#125; END &#123; print max, maxline &#125;&apos; gfs.data </span><br><span class="line">20000 Niu 60 199  20000</span><br></pre></td></tr></table></figure>
<p>打印至少包含一个字段的行</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">➜  tmp awk &apos;NF &gt; 0&apos; gfs.data</span><br><span class="line">Li 65 177 10000</span><br><span class="line">Wang 77 180 8000</span><br><span class="line">Niu 60 199  20000</span><br><span class="line">Chen 64.5 168 5000</span><br><span class="line">Ouyang 80 200 12000</span><br><span class="line">Liu 72.5 182 9999</span><br></pre></td></tr></table></figure>
<p>打印长度超过 20 个字符的行<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">➜  tmp awk &apos;length($0) &gt; 16&apos; gfs.data</span><br><span class="line">Niu 60 199  20000</span><br><span class="line">Chen 64.5 168 5000</span><br><span class="line">Ouyang 80 200 12000</span><br><span class="line">Liu 72.5 182 9999</span><br></pre></td></tr></table></figure></p>
<p>每一行的前面加上它的字段数<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">➜  tmp awk &apos;&#123;print NF, $0&#125;&apos;  gfs.data</span><br><span class="line">4 Li 65 177 10000</span><br><span class="line">4 Wang 77 180 8000</span><br><span class="line">4 Niu 60 199  20000</span><br><span class="line">4 Chen 64.5 168 5000</span><br><span class="line">4 Ouyang 80 200 12000</span><br><span class="line">4 Liu 72.5 182 9999</span><br></pre></td></tr></table></figure></p>
<p>打印每行第二，第一字段</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">➜  tmp awk &apos;&#123;print $2, $1&#125;&apos; gfs.data</span><br><span class="line">65 Li</span><br><span class="line">77 Wang</span><br><span class="line">60 Niu</span><br><span class="line">64.5 Chen</span><br><span class="line">80 Ouyang</span><br><span class="line">72.5 Liu</span><br></pre></td></tr></table></figure>
<p>交换一个字段并打印整行</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">➜  tmp awk &apos;&#123;tmp = $1; $1 = $2; $2 = tmp; print&#125;&apos; gfs.data</span><br><span class="line">65 Li 177 10000</span><br><span class="line">77 Wang 180 8000</span><br><span class="line">60 Niu 199 20000</span><br><span class="line">64.5 Chen 168 5000</span><br><span class="line">80 Ouyang 200 12000</span><br><span class="line">72.5 Liu 182 9999</span><br></pre></td></tr></table></figure>
<p>每行的第一个字段用行号代替</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">➜  tmp awk  &apos;&#123;$1 = NR; print&#125;&apos; gfs.data</span><br><span class="line">1 65 177 10000</span><br><span class="line">2 77 180 8000</span><br><span class="line">3 60 199 20000</span><br><span class="line">4 64.5 168 5000</span><br><span class="line">5 80 200 12000</span><br><span class="line">6 72.5 182 9999</span><br></pre></td></tr></table></figure>
<p>打印删除了第二个字段的行</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">➜  tmp awk &apos;&#123;$2 == &quot;&quot;; print&#125;&apos; gfs.data</span><br><span class="line">Li 65 177 10000</span><br><span class="line">Wang 77 180 8000</span><br><span class="line">Niu 60 199  20000</span><br><span class="line">Chen 64.5 168 5000</span><br><span class="line">Ouyang 80 200 12000</span><br><span class="line">Liu 72.5 182 9999</span><br></pre></td></tr></table></figure>
<p>每一行的字段按逆序打印</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">➜  tmp awk &apos;&#123; for (i=NF; i &gt; 0; i= i-1) &#123;printf(&quot;%s &quot;, $i)&#125; printf(&quot;\n&quot;)&#125;&apos; gfs.data</span><br><span class="line">10000 177 65 Li </span><br><span class="line">8000 180 77 Wang </span><br><span class="line">20000 199 60 Niu </span><br><span class="line">5000 168 64.5 Chen </span><br><span class="line">12000 200 80 Ouyang </span><br><span class="line">9999 182 72.5 Liu</span><br></pre></td></tr></table></figure>
<p>打印每一行的所有字段值之和</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">➜  tmp awk &apos;&#123;sum = 0; for (i=1; i &lt;=NF; i=i+1) &#123;sum = sum + $i&#125; print sum &#125;&apos; gfs.data</span><br><span class="line">10242</span><br><span class="line">8257</span><br><span class="line">20259</span><br><span class="line">5232.5</span><br><span class="line">12280</span><br><span class="line">10253.5</span><br></pre></td></tr></table></figure>
<p>将所有行的所有字段值累加起来 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">➜  tmp awk  &apos;&#123;for (i=1; i&lt;=NF; ++i) sum += $i&#125; END &#123;print sum&#125;&apos; gfs.data</span><br><span class="line">66524</span><br></pre></td></tr></table></figure>
<p>将所有行的所有字段值的绝对值 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">➜  tmp awk  &apos;&#123;for (i=1; i&lt;=NF; ++i) if ($i &lt; 0) &#123;$i = -$i&#125; print &#125;&apos;                  </span><br><span class="line">Li -65 -177 18000 # 这里手动输入带负数的值</span><br><span class="line">Li 65 177 18000 # 返回</span><br></pre></td></tr></table></figure>
<h3 id="Awk-语言之萝卜白菜"><a href="#Awk-语言之萝卜白菜" class="headerlink" title="Awk 语言之萝卜白菜"></a>Awk 语言之萝卜白菜</h3><p>输入一个文件 就叫 <code>radish.data</code> 吧, 这个文件大体就是这样的, 这个小节就用这个萝卜白菜来拌炒鱼肉吧<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">➜  tmp awk &apos;BEGIN &#123;print &quot;名称       重量 单价 分类\n&quot;&#125; &#123;printf(&quot;%-10s %6.2f %2.2f %-1s\n&quot;, $1, $2, $3, $4)&#125;&apos; radish.data</span><br><span class="line">名称       重量 单价 分类</span><br><span class="line"></span><br><span class="line">Fish        30.00 8.50 Meat</span><br><span class="line">Radish      14.00 1.20 Vegetables</span><br><span class="line">Cabbage     24.00 1.50 Vegetables</span><br><span class="line">Apple      100.00 2.50 Fruit</span><br><span class="line">Onion        8.00 0.80 Vegetables</span><br><span class="line">Banana      50.00 1.40 Fruit</span><br><span class="line">Beef       120.00 22.00 Meat</span><br><span class="line">Rice        40.00 10.00 Staple</span><br></pre></td></tr></table></figure></p>
<p>首先需要明确的是 Awk 炒的模式，有这么几种, 看过awk 起源之美女选男朋友的话，应该有 <em>似曾相识燕归去</em>的感觉。<br><code>BEGIN {statements}</code><br>  在输入被读取之前， statements 执行一次 , 就是不管你是爆炒还是水煮， 甭管你是鱼还是肉，你给我先洗洗!准备好油盐酱醋碗, 跟你炒没关系！<br><code>END {statements}</code><br>当所有输入读取完毕之后， statements 执行一次, 还是老话，管你吃饱没吃饱，你给我付钱！<br><code>expression {statements}</code><br>每碰到一个判断 expression 为真的输入行， statements 就执行一遍做菜流程. expression 为真的是其值非零或非空, 就是检查一下你放盐了没，油是不是太多了? 七分熟还是八分熟？<br><code>/regular expression/ {statements}</code><br>当碰到正则匹配的输入行时， statements就执行: 输入行含有一段字符串，而该字符串可以被 regular expression 匹配。一句话，老老实实按照菜谱来，要是在菜里被找到有头发或者小强便便，你丫就死定了！<br><code>compound pattern {statements}</code><br>多种模式， &amp;&amp;(AND), ||(OR), !(NOT), 以及括号组合起来。 当 <code>compound pattern</code> 为真时，statements执行。就是你可以 翻炒+添醋， 或者烘烤， 但是别给我整半生不熟的。<br><code>pattern_1, pattern_2 {statements}</code><br>一个范围模式匹配多个输入行，从pattern1 开始， 到 pattern_2 结束（包括这两行）, 对其中每一行执行statements操作。 你能露几手的环节可能就是在生火后，起锅前, 这段时间段，是你的表演时刻啊。</p>
<p>可以将你的七十二路炒菜法写下来， 放到 <code>cooking</code> 秘籍里,<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">BEGIN &#123; </span><br><span class="line">      printf(&quot;%-10s %s %s %s\n&quot;,</span><br><span class="line">          &quot;名称&quot;, &quot;重量&quot;, &quot;单价&quot;, &quot;分类&quot;)</span><br><span class="line">      &#125;</span><br><span class="line">      &#123; printf(&quot;%-10s %6.2f %6.2f %s\n&quot;, $1, $2, $3, $4)</span><br><span class="line">        weight = weight + $2</span><br><span class="line">        price  = price + $3*$2</span><br><span class="line">      &#125;</span><br><span class="line">END   &#123; printf(&quot;\n%10s %6.2f %6.2f\n&quot;, &quot;总共: &quot;, weight, price)</span><br><span class="line">      &#125;%</span><br></pre></td></tr></table></figure></p>
<p>下次传给万中无一的练武奇才时， 直接调用 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">➜  tmp awk -f cooking radish.data</span><br><span class="line">名称         重量 单价 分类</span><br><span class="line">Fish        30.00   8.50 Meat</span><br><span class="line">Radish      14.00   1.20 Vegetables</span><br><span class="line">Cabbage     24.00   1.50 Vegetables</span><br><span class="line">Apple      100.00   2.50 Fruit</span><br><span class="line">Onion        8.00   0.80 Vegetables</span><br><span class="line">Banana      50.00   1.40 Fruit</span><br><span class="line">Beef       120.00  22.00 Meat</span><br><span class="line">Rice        40.00  10.00 Staple</span><br><span class="line"></span><br><span class="line">      总共:  386.00 3674.20</span><br></pre></td></tr></table></figure>
<h3 id="刀片出鞘"><a href="#刀片出鞘" class="headerlink" title="刀片出鞘"></a>刀片出鞘</h3><p>一枝军刀片，千军万马削倒一遍!<br>欲知后事如何，且听不才我下回分解。。。。。。</p>
<!--more-->

    
  </div>

</article>


   

   
  <div class="box-prev-next clearfix">
    <a class="show pull-left" href="/2017-04-25-clean-code/">
        <i class="icon icon-angle-left"></i>
    </a>
    <a class="show pull-right" href="/2017-05-01-hello-world/">
        <i class="icon icon-angle-right"></i>
    </a>
  </div>





   
      <div class="git"></div>
   
</div>


  <a id="backTop" class="back-top">
    <i class="icon-angle-up"></i>
  </a>




  <div class="modal" id="modal">
  <span id="cover" class="cover hide"></span>
  <div id="modal-dialog" class="modal-dialog hide-dialog">
    <div class="modal-header">
      <span id="close" class="btn-close">关闭</span>
    </div>
    <hr>
    <div class="modal-body">
      <ul class="list-toolbox">
        
          <li class="item-toolbox">
            <a
              class="CIRCLE"
              href="/archives/"
              rel="noopener noreferrer"
              target="_self"
              >
              博客
            </a>
          </li>
        
          <li class="item-toolbox">
            <a
              class="CIRCLE"
              href="/tag/"
              rel="noopener noreferrer"
              target="_self"
              >
              标签
            </a>
          </li>
        
          <li class="item-toolbox">
            <a
              class="CIRCLE"
              href="/about/"
              rel="noopener noreferrer"
              target="_self"
              >
              关于
            </a>
          </li>
        
      </ul>

    </div>
  </div>
</div>



  
      <div class="fexo-comments comments-post">
    
  <section class="disqus-comments">
    <div id="disqus_thread">
      <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    </div>
  </section>

  <script>
    var disqus_shortname = 'chenyangguang';
    
    var disqus_url = 'http://chenyangguang.github.com/2017-04-25-awk/';
    
    (function(){
      var dsq = document.createElement('script');
      dsq.type = 'text/javascript';
      dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
  </script>

  <script id="dsq-count-scr" src="//chenyangguang.disqus.com/count.js" async></script>



    

    
    

    

    
    

    
        <section id="comment">
            
                <div id="disqus_thread">
                    <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
                </div>
            
        </section>
    
    
        <script type="text/javascript">
         var disqus_shortname = 'chenyangguang';
         var disqus_config = function () {
             this.page.url = 'http://chenyangguang.github.com/2017-04-25-awk/';
             this.page.identifier = '/2017-04-25-awk/';
             this.page.title = '瑞士军刀片 awk';
         };
         (function(){
             var d = document;
             var dsq = d.createElement('script');
             dsq.type = 'text/javascript';
             dsq.async = true;
             dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
             (d.head || d.body).appendChild(dsq);
         })();
        </script>
    

  </div>


  

  <script type="text/javascript">
  function loadScript(url, callback) {
    var script = document.createElement('script')
    script.type = 'text/javascript';

    if (script.readyState) { //IE
      script.onreadystatechange = function() {
        if (script.readyState == 'loaded' ||
          script.readyState == 'complete') {
          script.onreadystatechange = null;
          callback();
        }
      };
    } else { //Others
      script.onload = function() {
        callback();
      };
    }

    script.src = url;
    document.getElementsByTagName('head')[0].appendChild(script);
  }

  window.onload = function() {
    loadScript('/js/bundle.js?235683', function() {
      // load success
    });
  }
</script>

</body>
</html>
