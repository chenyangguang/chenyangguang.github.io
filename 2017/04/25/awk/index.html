<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 5.4.2">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.0/css/all.min.css" integrity="sha256-VHqXKFhhMxcpubYf9xiWdCiojEbY9NexQ4jh8AxbvcM=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"chenyangguang.github.com","root":"/","images":"/images","scheme":"Muse","darkmode":true,"version":"8.27.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"codeblock":{"theme":{"light":"default","dark":"stackoverflow-dark"},"prism":{"light":"prism","dark":"prism-dark"},"copy_button":{"enable":false,"style":null},"fold":{"enable":false,"height":500},"language":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"duration":200,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js" defer></script>

    <meta name="description" content="awk 起源之美女选男朋友说起瑞士军刀，可能很多人都听腻了。 有说 Emacs 是瑞士军刀的， 有说 Vim 也是瑞士军刀， 有说 Python 是瑞士军刀的。但是让我们暂时抛开对瑞士军刀的兴趣, 来拨弄一下一页小小的瑞士军刀片– awk。这个小家伙是一门小巧玲珑的特殊的编程语言。">
<meta property="og:type" content="article">
<meta property="og:title" content="瑞士军刀片 awk">
<meta property="og:url" content="http://chenyangguang.github.com/2017/04/25/awk/index.html">
<meta property="og:site_name" content="重剑无锋">
<meta property="og:description" content="awk 起源之美女选男朋友说起瑞士军刀，可能很多人都听腻了。 有说 Emacs 是瑞士军刀的， 有说 Vim 也是瑞士军刀， 有说 Python 是瑞士军刀的。但是让我们暂时抛开对瑞士军刀的兴趣, 来拨弄一下一页小小的瑞士军刀片– awk。这个小家伙是一门小巧玲珑的特殊的编程语言。">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2017-04-24T16:00:00.000Z">
<meta property="article:modified_time" content="2026-02-07T13:15:16.019Z">
<meta property="article:author" content="Gitvim">
<meta property="article:tag" content="灵犀指">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://chenyangguang.github.com/2017/04/25/awk/">


<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"http://chenyangguang.github.com/2017/04/25/awk/","path":"2017/04/25/awk/","title":"瑞士军刀片 awk"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>瑞士军刀片 awk | 重剑无锋</title>
  








  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous" defer></script>
<script src="/js/utils.js" defer></script><script src="/js/motion.js" defer></script><script src="/js/sidebar.js" defer></script><script src="/js/next-boot.js" defer></script>

  






  





  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">重剑无锋</p>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
    </div>
  </div>
</div>







</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Gitvim</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">57</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
        <span class="site-state-item-count">1</span>
        <span class="site-state-item-name">分类</span>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">22</span>
        <span class="site-state-item-name">标签</span>
      </div>
  </nav>
</div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://chenyangguang.github.com/2017/04/25/awk/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Gitvim">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="重剑无锋">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="瑞士军刀片 awk | 重剑无锋">
      <meta itemprop="description" content="awk 起源之美女选男朋友说起瑞士军刀，可能很多人都听腻了。 有说 Emacs 是瑞士军刀的， 有说 Vim 也是瑞士军刀， 有说 Python 是瑞士军刀的。但是让我们暂时抛开对瑞士军刀的兴趣, 来拨弄一下一页小小的瑞士军刀片– awk。这个小家伙是一门小巧玲珑的特殊的编程语言。">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          瑞士军刀片 awk
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2017-04-25 00:00:00" itemprop="dateCreated datePublished" datetime="2017-04-25T00:00:00+08:00">2017-04-25</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2026-02-07 21:15:16" itemprop="dateModified" datetime="2026-02-07T21:15:16+08:00">2026-02-07</time>
    </span>

  
</div>

            <div class="post-description">awk 起源之美女选男朋友说起瑞士军刀，可能很多人都听腻了。 有说 Emacs 是瑞士军刀的， 有说 Vim 也是瑞士军刀， 有说 Python 是瑞士军刀的。但是让我们暂时抛开对瑞士军刀的兴趣, 来拨弄一下一页小小的瑞士军刀片– awk。这个小家伙是一门小巧玲珑的特殊的编程语言。</div>
        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><p><a href="#awk-%E8%B5%B7%E6%BA%90%E4%B9%8B%E7%BE%8E%E5%A5%B3%E9%80%89%E7%94%B7%E6%9C%8B%E5%8F%8B"></a>awk 起源之美女选男朋友<br>说起瑞士军刀，可能很多人都听腻了。 有说 Emacs 是瑞士军刀的， 有说 Vim 也是瑞士军刀， 有说 Python 是瑞士军刀的。但是让我们暂时抛开对瑞士军刀的兴趣, 来拨弄一下一页小小的瑞士军刀片– awk。这个小家伙是一门小巧玲珑的特殊的编程语言。</p>
<p>不可我， 总结了一个最好的认识新事物的方法: 迎面冲上去。<br>看下面这组相亲数据 gfs.data : </p>
<p>1<br>2<br>3<br>4<br>5<br>6<br>Li 65 177 10000<br>Wang 77 180 8000<br>Niu 60 199  20000<br>Chen 64.5 168 5000<br>Ouyang 80 200 12000<br>Liu 72.5 182 9999</p>
<p>这片小数据里面包含几个字段， 人名，体重，身高, 月收入的数据。 比如美女需要从这里挑选男朋友标准，怎么选出这里面身高 177 以上的高富帅呢？ </p>
<p>1<br>2<br>3<br>4<br>5<br>➜  tmp awk ‘ $3 &gt; 177 { print $1,$3}’ gfs.data<br>Wang 180<br>Niu 199<br>Ouyang 200<br>Liu 182</p>
<p> tmp 是临时目录，这个是 zsh 里面的一个短路径，略过。 awk 程序的结构是 pattern { action } 的结构。<br>它会默认将字段看作非空白字符组成的序列。（所以你看那些中间的安安静静的空格，被当成是空气了。）剩下的，第一个字段姓名，就是 $1, 第二个体重是 $2, 177， 180, 199, 168, 200,182这些身高值就是 $3了, 依次类推下去。 整个一行是 $0。每个人的颜值，身家是可能不一样的, 也就是说 $n 的值长度是不一定一致的。</p>
<p> 单引号包起来的 $3 &gt; 177 是对每行扫描匹配的条件。当扫到 Wang 时， 很明显这家伙 180 超出预期值，需要多瞄几眼，看是否是 “八字” 合的来的真名天子，被挑出来了。按照这个模式一直搜到最后行， Liu 这个哥儿们也中彩了。<br>如果这位美女眼光比较高，她找男朋友的条件比较多，比如，收入要高，体重要匀称，智商要高等， 这样的话，最好是将她的条件给写到一个文件里面去， 名值曰: conditions.data。一次给她选中得意郎君。</p>
<figure class="highlight haskell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title">awk</span> -f conditions.<span class="class"><span class="keyword">data</span> gfs.<span class="keyword">data</span></span></span><br></pre></td></tr></table></figure>

<p>-f 表示从文件中提取程序，这个标准可以给多个姑娘参考, 选, 不中？不要， 中？ 要得！ 选…..选…..海选!</p>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">awk -f progfile optionnal <span class="built_in">list</span> <span class="keyword">of</span> files</span><br></pre></td></tr></table></figure>

<p>那么选择的条件一多了， 不想一条条罗列了，怎么给婚介所一个范围？ 用到字段的数量 NF 了。 NF 是 Awk 计算当前行的字段数量并存储的内建的变量。</p>
<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>➜  tmp awk  ‘{ print NF, $1, $NF }’ gfs.data<br>4 Li 10000<br>4 Wang 8000<br>4 Niu 20000<br>4 Chen 5000<br>4 Ouyang 12000<br>4 Liu 9999</p>
<p>这就打出每一个 boy 的 考察的条件数量，姓名，月收入了。直接拿这条件去撒网了。</p>
<p>打印真名天子所在的相亲次序 NR, 也是一个内建变量，是计算到目前为止，读取到的行的数量, 这里就是相亲的次数（假设这妹子每次相亲都换人）。</p>
<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>➜  tmp awk ‘{print NR, $0}’  gfs.data<br>1 Li 65 177 10000<br>2 Wang 77 180 8000<br>3 Niu 60 199  20000<br>4 Chen 64.5 168 5000<br>5 Ouyang 80 200 12000<br>6 Liu 72.5 182 9999</p>
<p>这几个的条件呢？ </p>
<p>1<br>2<br>3<br>➜  tmp awk ‘$4 &gt; 10000 {print “很有钱的人:”, $1, “ 月收入:”, $4 }’ gfs.data<br>很有钱的人: Niu  月收入: 20000<br>很有钱的人: Ouyang  月收入: 12000</p>
<p>人太多了，薪资位数不好比较，毕竟 0 太多了嘛! 筛选一下并格式化一下， 怎么搞？ printf(format, val_1, val_2, val_3, …, val_n), </p>
<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>➜  tmp awk ‘{printf(“%-8s 的月薪是 ￥%10.2f\n”, $1,$4)}’ gfs.data<br>Li       的月薪是 ￥  10000.00<br>Wang     的月薪是 ￥   8000.00<br>Niu      的月薪是 ￥  20000.00<br>Chen     的月薪是 ￥   5000.00<br>Ouyang   的月薪是 ￥  12000.00<br>Liu      的月薪是 ￥   9999.00</p>
<p>哎呀，还是看不清谁是优质男嘛，来，排下他们的薪资高低。 薪水往地处走，人往高处挑呀！ 用管道命令 sort 。</p>
<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>➜  tmp awk ‘{printf(“ %10.2f %s\n”, $4, $0)}’ gfs.data | sort -n<br>    5000.00 Chen 64.5 168 5000<br>    8000.00 Wang 77 180 8000<br>    9999.00 Liu 72.5 182 9999<br>   10000.00 Li 65 177 10000<br>   12000.00 Ouyang 80 200 12000<br>   20000.00 Niu 60 199  20000</p>
<p>原来牛哥是这里边最有 “钱途” 的！ 既然有三个是万元薪资的了，就先锁定他们了。毕竟谁会跟钱过不去？但是不能光看工资啊，要是这人是武大郎怎么办或者√2怎么办？ 不行，还是慎重一点，高开低走，190以上的，能过眼。长大了能像郎平和朱婷一样打排球，或者弄个小姚明？ 再加点条件吧： AND, OR 和 NOT, 用 &amp;&amp;, || 和 !</p>
<p>1<br>2<br>3<br>➜  tmp awk ‘$4 &gt;=10000 &amp;&amp; $3 &gt; 190 { print $0}’ gfs.data<br>Niu 60 199  20000<br>Ouyang 80 200 12000</p>
<p>这个输出少了一个醒目的标题, 说不定有妹子错将体重看成是腰围呢？为避免不必要的误解发生，还是加个头吧。<br>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>➜  tmp awk ‘BEGIN {print “姓名 体重 身高 薪水”; print “”}{print($0)}’ gfs.data<br>姓名 体重 身高 薪水</p>
<p>Li 65 177 10000<br>Wang 77 180 8000<br>Niu 60 199  20000<br>Chen 64.5 168 5000<br>Ouyang 80 200 12000<br>Liu 72.5 182 9999</p>
<p>哎呀，提前到约会地点了，闲着没事干，要么比较一下这些人的平均工资？</p>
<p>1<br>2<br>3<br>4<br>➜  tmp awk ‘{salary = salary + $4} END {print NR, “个人”;  print “总共月薪：”, salary; print “平均月 薪:”, salary/NR}’ gfs.data<br>6 个人<br>总共月薪： 64999<br>平均月薪: 10833.2</p>
<p>还不错嘛！人还没来，将所有相亲的人名品起来能组成一首诗么？ </p>
<p>1<br>2<br>➜  tmp awk ‘{names = names $1 “ “} END {print names }’  gfs.data<br>Li Wang Niu Chen Ouyang Liu</p>
<p>好吧，并没有。这些人名有多少笔画?啊不，是有几个字母组成？ </p>
<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>➜  tmp awk ‘ {print $1, length($1) } ‘ gfs.data<br>Li 2<br>Wang 4<br>Niu 3<br>Chen 4<br>Ouyang 6<br>Liu 3</p>
<p><a href="#%E5%86%9B%E5%88%80%E7%9A%84%E6%B5%81%E7%A8%8B"></a>军刀的流程<br>if-else 筛筛 </p>
<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>➜  tmp awk ‘$4 &gt; 10000 {n =  n + 1; salary = salary + $4 }{ if (n &gt; 0 &amp;&amp; $4 &gt; 10000)  print $1, “你有戏哟”; else {print $1, “你被out了”} }’ gfs.data<br>Li 你被out了<br>Wang 你被out了<br>Niu 你有戏哟<br>Chen 你被out了<br>Ouyang 你有戏哟<br>Liu 你被out了</p>
<p>while 循环, 从头梳理一边<br>1<br>2<br>3<br>4<br>5<br>6<br>7<br>awk ‘{ line[NR] = $0 } END { i = NR ;while (i&gt;0) { print line[i]; i = i - 1 }} ‘ gfs.data<br>Liu 72.5 182 9999<br>Ouyang 80 200 12000<br>Chen 64.5 168 5000<br>Niu 60 199  20000<br>Wang 77 180 8000<br>Li 65 177 10000</p>
<p>for  九九归一<br>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>➜  tmp awk ‘BEGIN {for (i=1; i &lt;=9; ++i) print i}’<br>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9</p>
<p><a href="#%E5%AE%9E%E7%94%A8%E2%80%9C%E7%89%87%E5%88%80%E5%BC%8F%E2%80%9D"></a>实用“片刀式”<br>输入行的总行数</p>
<p>1<br>2<br>➜  tmp awk ‘END { print NR}’ gfs.data<br>6</p>
<p>打印第四行 </p>
<p>1<br>2<br>➜  tmp awk ‘ NR == 4 ‘ gfs.data<br>Chen 64.5 168 5000</p>
<p>输出每一行最后一个字段 </p>
<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>➜  tmp awk ‘ {print $NF}’ gfs.data<br>10000<br>8000<br>20000<br>5000<br>12000<br>9999</p>
<p>打印最后一行的最后一个字段</p>
<p>1<br>2<br>➜  tmp awk ‘{field = $NF} END { print field }’  gfs.data<br>9999</p>
<p>打印字段数多于 3 个的输入行</p>
<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>➜  tmp awk ‘NF&gt;3’ gfs.data<br>Li 65 177 10000<br>Wang 77 180 8000<br>Niu 60 199  20000<br>Chen 64.5 168 5000<br>Ouyang 80 200 12000<br>Liu 72.5 182 9999</p>
<p>打印最后一个字段值大于10000的输入行</p>
<p>1<br>2<br>3<br>➜  tmp awk ‘$NF &gt; 10000 ‘ gfs.data<br>Niu 60 199  20000<br>Ouyang 80 200 12000</p>
<p>打印所有输入行的字段数的总和</p>
<p>1<br>2<br>➜  tmp awk ‘ {nf = nf + NF} END {print nf} ‘ gfs.data<br>24</p>
<p>打印包含 /Niu/ 的行的数量</p>
<p>1<br>2<br>➜  tmp awk ‘ /Niu/ {nlines = nlines + 1} END {print nlines}’ gfs.data<br>1</p>
<p>打印具有最大值的第4个字段，以及包含它的行(假设 $1 总是正的)</p>
<p>1<br>2<br>➜  tmp awk ‘$4 &gt; max { max=$4; maxline=$0 } END { print max, maxline }’ gfs.data<br>20000 Niu 60 199  20000</p>
<p>打印至少包含一个字段的行</p>
<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>➜  tmp awk ‘NF &gt; 0’ gfs.data<br>Li 65 177 10000<br>Wang 77 180 8000<br>Niu 60 199  20000<br>Chen 64.5 168 5000<br>Ouyang 80 200 12000<br>Liu 72.5 182 9999</p>
<p>打印长度超过 20 个字符的行<br>1<br>2<br>3<br>4<br>5<br>➜  tmp awk ‘length($0) &gt; 16’ gfs.data<br>Niu 60 199  20000<br>Chen 64.5 168 5000<br>Ouyang 80 200 12000<br>Liu 72.5 182 9999</p>
<p>每一行的前面加上它的字段数<br>1<br>2<br>3<br>4<br>5<br>6<br>7<br>➜  tmp awk ‘{print NF, $0}’  gfs.data<br>4 Li 65 177 10000<br>4 Wang 77 180 8000<br>4 Niu 60 199  20000<br>4 Chen 64.5 168 5000<br>4 Ouyang 80 200 12000<br>4 Liu 72.5 182 9999</p>
<p>打印每行第二，第一字段</p>
<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>➜  tmp awk ‘{print $2, $1}’ gfs.data<br>65 Li<br>77 Wang<br>60 Niu<br>64.5 Chen<br>80 Ouyang<br>72.5 Liu</p>
<p>交换一个字段并打印整行</p>
<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>➜  tmp awk ‘{tmp = $1; $1 = $2; $2 = tmp; print}’ gfs.data<br>65 Li 177 10000<br>77 Wang 180 8000<br>60 Niu 199 20000<br>64.5 Chen 168 5000<br>80 Ouyang 200 12000<br>72.5 Liu 182 9999</p>
<p>每行的第一个字段用行号代替</p>
<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>➜  tmp awk  ‘{$1 = NR; print}’ gfs.data<br>1 65 177 10000<br>2 77 180 8000<br>3 60 199 20000<br>4 64.5 168 5000<br>5 80 200 12000<br>6 72.5 182 9999</p>
<p>打印删除了第二个字段的行</p>
<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>➜  tmp awk ‘{$2 == “”; print}’ gfs.data<br>Li 65 177 10000<br>Wang 77 180 8000<br>Niu 60 199  20000<br>Chen 64.5 168 5000<br>Ouyang 80 200 12000<br>Liu 72.5 182 9999</p>
<p>每一行的字段按逆序打印</p>
<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>➜  tmp awk ‘{ for (i=NF; i &gt; 0; i= i-1) {printf(“%s “, $i)} printf(“\n”)}’ gfs.data<br>10000 177 65 Li<br>8000 180 77 Wang<br>20000 199 60 Niu<br>5000 168 64.5 Chen<br>12000 200 80 Ouyang<br>9999 182 72.5 Liu</p>
<p>打印每一行的所有字段值之和</p>
<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>➜  tmp awk ‘{sum = 0; for (i=1; i &lt;=NF; i=i+1) {sum = sum + $i} print sum }’ gfs.data<br>10242<br>8257<br>20259<br>5232.5<br>12280<br>10253.5</p>
<p>将所有行的所有字段值累加起来 </p>
<p>1<br>2<br>➜  tmp awk  ‘{for (i=1; i&lt;=NF; ++i) sum += $i} END {print sum}’ gfs.data<br>66524</p>
<p>将所有行的所有字段值的绝对值 </p>
<p>1<br>2<br>3<br>➜  tmp awk  ‘{for (i=1; i&lt;=NF; ++i) if ($i &lt; 0) {$i = -$i} print }’<br>Li -65 -177 18000 # 这里手动输入带负数的值<br>Li 65 177 18000 # 返回</p>
<p><a href="#Awk-%E8%AF%AD%E8%A8%80%E4%B9%8B%E8%90%9D%E5%8D%9C%E7%99%BD%E8%8F%9C"></a>Awk 语言之萝卜白菜<br>输入一个文件 就叫 radish.data 吧, 这个文件大体就是这样的, 这个小节就用这个萝卜白菜来拌炒鱼肉吧<br>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>➜  tmp awk ‘BEGIN {print “名称       重量 单价 分类\n”} {printf(“%-10s %6.2f %2.2f %-1s\n”, $1, $2, $3, $4)}’ radish.data<br>名称       重量 单价 分类</p>
<p>Fish        30.00 8.50 Meat<br>Radish      14.00 1.20 Vegetables<br>Cabbage     24.00 1.50 Vegetables<br>Apple      100.00 2.50 Fruit<br>Onion        8.00 0.80 Vegetables<br>Banana      50.00 1.40 Fruit<br>Beef       120.00 22.00 Meat<br>Rice        40.00 10.00 Staple</p>
<p>首先需要明确的是 Awk 炒的模式，有这么几种, 看过awk 起源之美女选男朋友的话，应该有 似曾相识燕归去的感觉。<br>BEGIN {statements}<br>  在输入被读取之前， statements 执行一次 , 就是不管你是爆炒还是水煮， 甭管你是鱼还是肉，你给我先洗洗!准备好油盐酱醋碗, 跟你炒没关系！<br>END {statements}<br>当所有输入读取完毕之后， statements 执行一次, 还是老话，管你吃饱没吃饱，你给我付钱！<br>expression {statements}<br>每碰到一个判断 expression 为真的输入行， statements 就执行一遍做菜流程. expression 为真的是其值非零或非空, 就是检查一下你放盐了没，油是不是太多了? 七分熟还是八分熟？<br>/regular expression/ {statements}<br>当碰到正则匹配的输入行时， statements就执行: 输入行含有一段字符串，而该字符串可以被 regular expression 匹配。一句话，老老实实按照菜谱来，要是在菜里被找到有头发或者小强便便，你丫就死定了！<br>compound pattern {statements}<br>多种模式， &amp;&amp;(AND), ||(OR), !(NOT), 以及括号组合起来。 当 compound pattern 为真时，statements执行。就是你可以 翻炒+添醋， 或者烘烤， 但是别给我整半生不熟的。<br>pattern_1, pattern_2 {statements}<br>一个范围模式匹配多个输入行，从pattern1 开始， 到 pattern_2 结束（包括这两行）, 对其中每一行执行statements操作。 你能露几手的环节可能就是在生火后，起锅前, 这段时间段，是你的表演时刻啊。</p>
<p>可以将你的七十二路炒菜法写下来， 放到 cooking 秘籍里,<br>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>BEGIN {<br>      printf(“%-10s %s %s %s\n”,<br>          “名称”, “重量”, “单价”, “分类”)<br>      }<br>      { printf(“%-10s %6.2f %6.2f %s\n”, $1, $2, $3, $4)<br>        weight = weight + $2<br>        price  = price + $3*$2<br>      }<br>END   { printf(“\n%10s %6.2f %6.2f\n”, “总共: “, weight, price)<br>      }%</p>
<p>下次传给万中无一的练武奇才时， 直接调用 </p>
<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>➜  tmp awk -f cooking radish.data<br>名称         重量 单价 分类<br>Fish        30.00   8.50 Meat<br>Radish      14.00   1.20 Vegetables<br>Cabbage     24.00   1.50 Vegetables<br>Apple      100.00   2.50 Fruit<br>Onion        8.00   0.80 Vegetables<br>Banana      50.00   1.40 Fruit<br>Beef       120.00  22.00 Meat<br>Rice        40.00  10.00 Staple</p>
<pre><code>  总共:  386.00 3674.20
</code></pre>
<p><a href="#%E5%88%80%E7%89%87%E5%87%BA%E9%9E%98"></a>刀片出鞘<br>一枝军刀片，千军万马削倒一遍!<br>欲知后事如何，且听不才我下回分解。。。。。。</p>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/%E7%81%B5%E7%8A%80%E6%8C%87/" rel="tag"># 灵犀指</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2017/04/25/clean-code/" rel="prev" title="Clean Code">
                  <i class="fa fa-angle-left"></i> Clean Code
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2017/05/01/hello-world/" rel="next" title="Hexo blog begin">
                  Hexo blog begin <i class="fa fa-angle-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">
  <div class="languages">
    <label class="lang-select-label">
      <i class="fa fa-language"></i>
      <span>简体中文</span>
      <i class="fa fa-angle-up" aria-hidden="true"></i>
    </label>
    <select class="lang-select" data-canonical="" aria-label="选择语言">
      
        <option value="zh-CN" data-href="/2017/04/25/awk/" selected="">
          简体中文
        </option>
      
        <option value="en" data-href="/en/2017/04/25/awk/" selected="">
          English
        </option>
      
    </select>
  </div>

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2026</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">Gitvim</span>
  </div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" rel="noopener" target="_blank">NexT.Muse</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>

</body>
</html>
